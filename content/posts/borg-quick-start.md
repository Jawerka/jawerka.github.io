+++
date = '2024-10-25T09:08:04+03:00'
draft = false
title = 'Borg Quick Start'
+++

Это переведенная нейросетями статья [Borg - quick start](https://borgbackup.readthedocs.io/en/stable/quickstart.html)

---

### Установка

Для установки borg:

```bash
sudo apt install borgbackup
```

Для установки более новой версии brog:

```
sudo apt install python3 python3-pip -y

python3 -m pip install --upgrade pip

sudo pip install borgbackup
```

*`borg compact`  может не работать в старых версиях*

## Глава о Borg

Эта глава познакомит вас с использованием Borg и охватит различные сценарии его применения.

### Пошаговый пример

Перед тем как создать резервную копию, необходимо инициализировать репозиторий:

```bash
borg init --encryption=repokey /path/to/repo
```

Создайте архив с названием `Monday`, содержащий директории `~/src` и `~/Documents`:

```bash
borg create /path/to/repo::Monday ~/src ~/Documents
```

На следующий день создайте новый архив под названием `Tuesday`:

```bash
borg create --stats /path/to/repo::Tuesday ~/src ~/Documents
```

Эта резервная копия будет гораздо быстрее и займёт меньше места, так как будут сохранены только новые данные. Опция `--stats` вызовет вывод статистики о созданном архиве:

```
------------------------------------------------------------------------------
Archive name: Tuesday
Archive fingerprint: bd31004d58f51ea06ff735d2e5ac49376901b21d58035f8fb05dbf866566e3c2
Time (start): Tue, 2016-02-16 18:15:11
Time (end):   Tue, 2016-02-16 18:15:11

Duration: 0.19 seconds
Number of files: 127
------------------------------------------------------------------------------
                      Original size      Compressed size    Deduplicated size
This archive:                4.16 MB              4.17 MB             26.78 kB
All archives:                8.33 MB              8.34 MB              4.19 MB

                      Unique chunks         Total chunks
Chunk index:                     132                  261
------------------------------------------------------------------------------
```

### Список всех архивов в репозитории:

```bash
borg list /path/to/repo

Monday                               Mon, 2016-02-15 19:14:44
Tuesday                              Tue, 2016-02-16 19:15:11
```

### Просмотр содержимого архива `Monday`:

```bash
borg list /path/to/repo::Monday

drwxr-xr-x user   group          0 Mon, 2016-02-15 18:22:30 home/user/Documents
-rw-r--r-- user   group       7961 Mon, 2016-02-15 18:22:30 home/user/Documents/Important.doc
...
```

### Восстановление архива `Monday`:

```bash
borg extract /path/to/repo::Monday
```

### Удаление архива `Monday` (не освобождает место на диске):

```bash
borg delete /path/to/repo::Monday
```

### Освобождение места путём компактации сегментных файлов:

```bash
borg compact /path/to/repo
```

### Примечание

Borg по умолчанию работает в тихом режиме (уровень логирования — WARNING). Вы можете использовать такие опции, как `--progress` или `--list`, чтобы получать отчеты во время выполнения команд. Также можно добавить опцию `-v` (или `--verbose`, или `--info`), чтобы изменить уровень логирования на INFO и получать другие информационные сообщения.

## Архивы и репозитории

*Архив Borg* — это результат одной резервной копии (`borg create`). Архив хранит снимок данных файлов, находящихся "внутри" него. Позже можно извлечь или смонтировать архив, чтобы восстановить данные из резервной копии.

*Репозитории* — это каталоги файловой системы, действующие как самостоятельные хранилища архивов. К репозиториям можно получить доступ локально по пути или удалённо через SSH. Внутри репозиториев содержатся блоки данных и манифест, отслеживающий, какие блоки находятся в каждом архиве. Если некоторые данные не изменились с одной резервной копии на другую, Borg может просто ссылаться на уже загруженный кусок данных (дедупликация).

## Важное примечание о свободном пространстве

Перед тем как начать создавать резервные копии, убедитесь, что на файловой системе, где находится ваш репозиторий резервных копий (а также в `~/.cache`), всегда достаточно свободного места. Несколько гигабайт должно хватить для большинства репозиториев, размещенных на жестких дисках. Также смотрите раздел [Использование памяти индексов / кэшей](https://borgbackup.readthedocs.io/en/stable/internals/data-structures.html#cache-memory-usage).

Borg не использует пространство, зарезервированное для `root` на дисках репозитория (даже при запуске от имени `root`). На файловых системах, которые не поддерживают этот механизм (например, XFS), рекомендуется зарезервировать некоторое пространство в самом Borg для подстраховки, отрегулировав настройку `additional_free_space` (хорошей отправной точкой будет `2G`):

```bash
borg config /path/to/repo additional_free_space 2G
```

## Важное примечание о разрешениях

Чтобы избежать проблем с разрешениями (в вашем репозитории Borg или кэше Borg), **всегда получайте доступ к репозиторию, используя одну и ту же учетную запись пользователя**.

Если вы хотите делать резервные копии файлов других пользователей или операционной системы, вероятно, потребуется запускать Borg от имени `root` (в противном случае вы получите ошибки доступа). Если вы делаете резервные копии только своих файлов, вам не нужно и не желательно запускать Borg от имени `root` — просто запускайте его от имени вашего обычного пользователя.

Для локального репозитория всегда используйте одного и того же пользователя для вызова Borg.

Для удаленного репозитория: всегда используйте, например, `borg@remote_host`. Вы можете использовать это от разных локальных пользователей, но удаленный пользователь, запускающий Borg и получающий доступ к репозиторию, всегда будет `borg`.

Если вам нужно получить доступ к локальному репозиторию от разных пользователей, вы можете использовать тот же метод, используя SSH для `borg@localhost`.

## Важное примечание о файлах, изменяющихся в процессе резервного копирования

Borg не заботится о внутренней целостности данных, которые он сохраняет. Он просто считывает и создает резервные копии каждого файла в том состоянии, в котором он находится, когда Borg к нему обращается. На активной системе это может привести к двум видам несоответствия:

- К тому времени, когда Borg создает резервную копию файла, он мог измениться с момента инициации процесса резервного копирования.

- Файл может измениться, пока Borg создает его резервную копию, что сделает файл внутренне несоответствующим.

Если у вас есть набор файлов и вы хотите гарантировать, что они будут сохранены в определенном или согласованном состоянии, необходимо предпринять шаги для предотвращения изменений этих файлов в процессе резервного копирования. Существуют несколько общих методов достижения этого:

- Избегайте запуска любых программ, которые могут изменить файлы.

- Создавайте снимки файлов, файловых систем, контейнерных томов или логических томов. В этом случае могут быть полезны LVM или ZFS.

- Дампите базы данных или останавливайте серверы баз данных.

- Выключайте виртуальные машины перед резервным копированием их образов.

- Выключайте контейнеры перед резервным копированием их томов хранения.

Для некоторых систем Borg может работать достаточно хорошо без этих предосторожностей. Если вы просто делаете резервные копии файлов на системе, которая не очень активна (например, в типичном домашнем каталоге), Borg обычно работает достаточно хорошо без дополнительной заботы о целостности. Журналы и кэши могут быть не в идеальном состоянии, но это редко является проблемой.

Для баз данных, виртуальных машин и контейнеров существуют специальные методы резервного копирования, которые не просто используют Borg для резервного копирования подлежащей файловой системы. Для баз данных проверьте документацию вашей базы данных на наличие техник, которые сохранят состояние базы данных между транзакциями. Для виртуальных машин рассмотрите возможность выполнения резервного копирования непосредственно на виртуальной машине или монтирования файловой системы, пока виртуальная машина выключена. Для контейнеров Docker возможно, команда "save" Docker может помочь.

## Автоматизация резервного копирования

Следующий пример скрипта предназначен для ежедневного запуска пользователем `root` на различных локальных машинах. Он создает резервные копии важных файлов машины (но не всей операционной системы) в репозиторий `~/backup/main` на удаленном сервере. Некоторые файлы, которые не являются обязательными для этой резервной копии, исключаются. См. раздел [borg help patterns](https://borgbackup.readthedocs.io/en/stable/usage/help.html#borg-patterns) для получения информации о том, как добавить дополнительные параметры исключения.

После резервного копирования этот скрипт также использует подкоманду [borg prune](https://borgbackup.readthedocs.io/en/stable/usage/prune.html#borg-prune), чтобы оставить только определенное количество старых архивов и удалить остальные.

В завершение он использует подкоманду [borg compact](https://borgbackup.readthedocs.io/en/stable/usage/compact.html#borg-compact) для удаления удаленных объектов из сегментных файлов в репозитории, чтобы сохранить место на диске.

Перед запуском убедитесь, что репозиторий инициализирован, как указано в разделе [Удаленные репозитории](https://borgbackup.readthedocs.io/en/stable/quickstart.html#remote-repos), и что скрипт имеет правильные разрешения для выполнения пользователем `root`, но не может быть выполнен или прочитан никем другим, т.е. `root:root 0700`.

Вы можете использовать этот скрипт в качестве отправной точки и модифицировать его по мере необходимости, чтобы он соответствовал вашей конфигурации.

Не забудьте протестировать созданные резервные копии, чтобы убедиться, что все необходимые данные сохраняются, и что команда `prune` правильно сохраняет и удаляет архивы.

```bash
#!/bin/sh

# Устанавливаем это, чтобы репозиторий не нужно было указывать в командной строке:
export BORG_REPO=ssh://username@example.com:2022/~/backup/main

# См. раздел "Примечания по паролю" для получения дополнительной информации.
export BORG_PASSPHRASE='XYZl0ngandsecurepa_55_phrasea&&123'

# Некоторые вспомогательные функции и обработка ошибок:
info() { printf "\n%s %s\n\n" "$(date)" "$*" >&2; }
trap 'echo $(date) Резервное копирование прервано >&2; exit 2' INT TERM

info "Запуск резервного копирования"

# Резервное копирование самых важных директорий в архив, названный в честь
# машины, на которой в данный момент выполняется этот скрипт:

borg create                         \
    --verbose                       \
    --filter AME                    \
    --list                          \
    --stats                         \
    --show-rc                       \
    --compression lz4               \
    --exclude-caches                \
    --exclude 'home/*/.cache/*'     \
    --exclude 'var/tmp/*'           \
                                    \
    ::'{hostname}-{now}'            \
    /etc                            \
    /home                           \
    /root                           \
    /var

backup_exit=$?

info "Очистка репозитория"

# Используйте подкоманду `prune`, чтобы поддерживать 7 ежедневных, 4 еженедельных и 6 ежемесячных
# архивов ЭТОЙ машины. Совпадение '{hostname}-*' очень важно для
# ограничения операции prune архивами этой машины и предотвращения
# применения к архивам других машин:

borg prune                          \
    --list                          \
    --glob-archives '{hostname}-*'  \
    --show-rc                       \
    --keep-daily    7               \
    --keep-weekly   4               \
    --keep-monthly  6

prune_exit=$?

# Фактически освобождаем место на диске репозитория, сжимая сегменты

info "Сжатие репозитория"

borg compact

compact_exit=$?

# Используем самый высокий код выхода как глобальный код выхода
global_exit=$(( backup_exit > prune_exit ? backup_exit : prune_exit ))
global_exit=$(( compact_exit > global_exit ? compact_exit : global_exit ))

if [ ${global_exit} -eq 0 ]; then
    info "Резервное копирование, очистка и сжатие завершены успешно"
elif [ ${global_exit} -eq 1 ]; then
    info "Резервное копирование, очистка и/или сжатие завершены с предупреждениями"
else
    info "Резервное копирование, очистка и/или сжатие завершены с ошибками"
fi

exit ${global_exit}
```

## Подводные камни с переменными оболочки и переменными окружения

Это относится ко всем переменным окружения, которые вы хотите, чтобы Borg видел, а не только к `BORG_PASSPHRASE`. Краткое объяснение: всегда используйте `export` для вашей переменной и применяйте одинарные кавычки, если вы не уверены в поведении расширения вашей оболочки. Например:

```bash
export BORG_PASSPHRASE='сложный & длинный'
```

Это связано с тем, что `export` делает переменные доступными для подпроцессов, одним из которых может быть Borg. Более подробную информацию о `export` можно найти в разделе “ENVIRONMENT” справочной страницы bash(1).

Будьте осторожны с тем, как `sudo` взаимодействует с переменными окружения. Например, вы можете быть удивлены, что следующий `export` не влияет на вашу команду:

```bash
export BORG_PASSPHRASE='сложный & длинный'
sudo ./yourborgwrapper.sh  # все равно запрашивает пароль
```

Для получения дополнительной информации обратитесь к справочной странице sudo(8) и `env_keep` в справочной странице sudoers(5).

### Совет

Чтобы отладить, что ваш процесс Borg на самом деле видит, найдите его PID (`ps aux | grep borg`), а затем посмотрите в `/proc/<PID>/environ`.

## Примечания по паролю

Если вы используете шифрование (или аутентификацию), Borg будет интерактивно запрашивать у вас пароль для шифрования/дешифрования файла ключа / репоключа.

Пароль должен быть одной строкой текста; завершающий перевод строки будет удален.

Для вашей безопасности вам стоит избегать пустых паролей, а также очень длинных паролей (более 256 бит энтропии).

Также избегайте паролей, содержащих не-ASCII символы. Технически Borg способен обрабатывать весь текст в Юникоде, но у вас могут возникнуть проблемы с воспроизведением одинаковых закодированных байтов UTF-8 или с раскладками клавиатуры, поэтому лучше избегать не-ASCII символов.

Если вы хотите автоматизировать процесс, вы можете предоставить пароль напрямую или косвенно, используя некоторые переменные окружения.

Вы можете напрямую указать пароль:

```bash
# используйте этот пароль (используйте безопасные права доступа к скрипту!):
export BORG_PASSPHRASE='мой супер секретный пароль'
```

Или попросить внешнюю программу предоставить пароль:

```bash
# используйте менеджер паролей "pass" для получения пароля:
export BORG_PASSCOMMAND='pass show backup'

# используйте GPG для получения пароля, содержащегося в gpg-зашифрованном файле:
export BORG_PASSCOMMAND='gpg --decrypt borg-passphrase.gpg'
```

Или прочитать пароль из открытого файлового дескриптора:

```bash
export BORG_PASSPHRASE_FD=42
```

Использование аппаратных криптоустройств (таких как Nitrokey, Yubikey и других) не поддерживается напрямую в Borg, но вы можете использовать их косвенно. Например, если ваше криптоустройство поддерживает GPG и Borg вызывает `gpg` через `BORG_PASSCOMMAND`, это должно работать.

# Сжатие резервных копий

По умолчанию используется метод сжатия `lz4` (очень быстрый, но с низким коэффициентом сжатия), однако для разных ситуаций поддерживаются и другие методы.

Вы можете использовать `zstd` для широкого диапазона настроек: от высокой скорости (и относительно низкого сжатия) с `N=1` до высокого сжатия (и низкой скорости) с `N=22`.

`zstd` — это современный алгоритм сжатия и может быть предпочтительным по сравнению с `zlib` и `lzma`, за исключением случаев, когда необходима совместимость с более старыми версиями Borg (< 1.1.4), в которых `zstd` еще не поддерживался:

```bash
$ borg create --compression zstd,N /path/to/repo::arch ~ 
```

### Другие варианты:

Если у вас быстрый хранилище репозитория и вы хотите минимальное использование ЦП, без сжатия:

```bash
$ borg create --compression none /path/to/repo::arch ~
```

Если у вас менее быстрое хранилище репозитория и вы хотите немного большее сжатие (N=0..9, где 0 означает отсутствие сжатия, а 9 — высокое сжатие):

```bash
$ borg create --compression zlib,N /path/to/repo::arch ~
```

Если у вас очень медленное хранилище репозитория и вы хотите высокое сжатие (N=0..9, где 0 означает низкое сжатие, а 9 — высокое сжатие):

```bash
$ borg create --compression lzma,N /path/to/repo::arch ~
```

Вам потребуется немного поэкспериментировать, чтобы найти наилучший вариант сжатия для вашего случая. Обратите внимание на нагрузку на процессор и пропускную способность.

## Шифрование репозитория

Вы можете выбрать режим шифрования репозитория во время его создания:

```bash
$ borg init --encryption=MODE PATH
```

Для получения списка доступных режимов шифрования и их описаний, пожалуйста, обратитесь к [borg init](https://borgbackup.readthedocs.io/en/stable/usage/init.html#borg-init).

Если вы используете шифрование, все данные шифруются на клиенте перед записью в репозиторий. Это означает, что злоумышленник, который сможет скомпрометировать хост, содержащий зашифрованный репозиторий, не сможет получить доступ к каким-либо данным, даже во время выполнения резервного копирования.

Ключевые материалы хранятся в зашифрованном виде и могут быть расшифрованы только при предоставлении правильного пароля.

Для автоматизированных резервных копий пароль можно указать с помощью переменной окружения `BORG_PASSPHRASE`.

### Примечание

Будьте осторожны с тем, как вы устанавливаете эту переменную окружения, смотрите [эту заметку о переменных окружения для паролей](https://borgbackup.readthedocs.io/en/stable/faq.html#password-env) для получения дополнительной информации.

### Предупреждение

Данные репозитория полностью недоступны без ключа и пароля к ключу.

Создайте резервную копию файла ключа (в режиме `keyfile`) или файла конфигурации репозитория (в режиме `repokey`) и храните ее в безопасном месте, чтобы вы все еще имели ключ на случай его повреждения или потери. Также храните ваш пароль в безопасном месте. Вы можете сделать резервные копии с помощью подкоманды [borg key export](https://borgbackup.readthedocs.io/en/stable/usage/key.html#borg-key-export).

Если вы хотите напечатать резервную копию вашего ключа на бумаге, используйте опцию `--paper` этой команды и распечатайте результат, или распечатайте этот [шаблон](https://borgbackup.readthedocs.io/en/stable/paperkey.html), если вам нужна версия с QR-кодом.

Резервная копия внутри резервной копии, зашифрованная с помощью этого ключа/пароля, конечно же, не поможет вам в этом.

В случае потери вашего репозитория и информации о безопасности, но наличии старой копии для восстановления, не используйте ее позднее для создания новых резервных копий — вы столкнетесь с проблемами безопасности (повторное использование значений счетчика nonce). Лучше инициализировать новый репозиторий Borg. Также смотрите: [Мой репозиторий поврежден, как я могу восстановить его из более ранней копии?](https://borgbackup.readthedocs.io/en/stable/faq.html#faq-corrupt-repo)

## Удаленные репозитории

Borg может инициализировать и получать доступ к репозиториям на удаленных хостах, если хост доступен через SSH. Это быстрее и проще, когда Borg установлен на удаленном хосте. В этом случае используется следующий синтаксис:

```bash
$ borg init user@hostname:/path/to/repo
```

**Примечание:** Пожалуйста, смотрите раздел использования для получения полной документации по URL репозиториев.

Удаленные операции через SSH можно автоматизировать с помощью SSH-ключей. Вы можете ограничить использование пары SSH-ключей, добавив принудительную команду в публичный ключ SSH в файле `authorized_keys` на удаленном сервере. В этом примере Borg будет запущен в режиме сервера и ограничен определенным файловым путем:

```bash
command="borg serve --restrict-to-path /path/to/repo",restrict ssh-rsa AAAAB3[...]
```

Если установка Borg на удаленном хосте невозможна, все еще можно использовать удаленный хост для хранения репозитория, монтируя удаленную файловую систему, например, с помощью sshfs:

```bash
$ sshfs user@hostname:/path/to /path/to
$ borg init /path/to/repo
$ fusermount -u /path/to
```

Вы также можете использовать другие удаленные файловые системы аналогичным образом. Просто будьте осторожны: не все файловые системы достаточно стабильны и работают хорошо для использования в резервном копировании.

## Восстановление резервной копии

Обратите внимание, что мы здесь описываем только самые основные команды и параметры. Для получения дополнительной информации обратитесь к справочнику команд.

Для восстановления вы обычно хотите работать **на том же компьютере тем же пользователем**, который использовался для создания резервных копий нужных файлов. Это позволяет избежать многих проблем:

- отсутствие путаницы с путями;
- такое же сопоставление имен пользователей/групп с идентификаторами пользователей/групп;
- отсутствие проблем с правами доступа;
- скорее всего, у вас уже есть рабочая настройка Borg:
  - возможно, с переменной окружения для ключевой фразы (для зашифрованных репозиториев);
  - возможно, с файлом ключа для репозитория (не требуется для режима `repokey`);
  - возможно, с SSH-ключом для сервера репозитория (не требуется для локально смонтированных репозиториев);
  - возможно, с действительным кэшем Borg для этого репозитория (быстрее, чем его перестройка).

**Пользователь** может быть:

- `root` (если были сделаны полные резервные копии, включая системные файлы или файлы нескольких пользователей);
- конкретный пользователь, использующий `sudo` для выполнения Borg от имени `root`;
- конкретный пользователь (если были сделаны резервные копии файлов этого пользователя).

**Репозиторий резервного копирования** может быть:

- в локальном каталоге (например, на локально смонтированном USB-накопителе);
- на удаленном сервере резервного копирования, доступном по SSH (клиент/сервер).

Если репозиторий зашифрован, вам также понадобится **ключ** и **пароль** (который защищает ключ).

**Ключ** может находиться:

- в репозитории (**repokey** режим).  
  Это просто, обычно это «просто работает».

- в домашнем каталоге пользователя, который делал резервную копию (**keyfile** режим).  
  Это может потребовать немного больше усилий:
  
  - если вы только что потеряли этот домашний каталог и вам нужно восстановить ключ Borg (например, из отдельной резервной копии, которую вы сделали, или от другого пользователя или машины, имеющей доступ к тому же репозиторию);
  - если вам нужно выяснить правильную машину/пользователя/домашний каталог, где был запущен клиент Borg для создания резервных копий.

**Пароль** для ключа может быть:

- введен интерактивно во время резервного копирования (не практично, если резервное копирование автоматизировано/без присмотра);
- получен через механизм, управляемый переменной окружения в скрипте резервного копирования (ищите там `BORG_PASSPHRASE`, `BORG_PASSCOMMAND` и т. д. и просто сделайте это так).

Существуют **два способа восстановить** файлы из репозитория резервного копирования Borg:

- **borg mount** — используйте это, если:
  
  - вы не совсем знаете, какие файлы хотите восстановить;
  - вы не знаете, какой архив содержит нужные файлы;
  - вам нужно просмотреть файлы/каталоги перед тем, как решить, что вы хотите;
  - вам нужно восстановить относительно небольшой объем данных;
  - вам не важен восстановление объектов, которые FUSE-монтирование пока не поддерживает (например, специальные флаги файловой системы, ACL);
  - у вас клиент с хорошими ресурсами (ОЗУ, ЦП, временное дисковое пространство);
  - вы хотите использовать файловый менеджер для восстановления (копирования) файлов, а не команды оболочки `borg extract`.

- **borg extract** — используйте это, если:
  
  - вы точно знаете, что хотите (репозиторий, архив, путь);
  - вам нужно восстановить большой объем файлов (лучшая скорость);
  - вы хотите максимально полное воспроизведение метаданных файлов (например, специальные флаги файловой системы, ACL);
  - у вас клиент с низкими ресурсами (ОЗУ, ЦП, временное дисковое пространство).

### Пример с **borg mount**:

```bash
# Откройте новый, отдельный терминал (этот терминал будет заблокирован до размонтирования).

# Теперь мы узнаем имена архивов, которые у нас есть в репозитории:
borg list /mnt/backup/borg_repo

# Смонтируем один архив из репозитория Borg:
borg mount /mnt/backup/borg_repo::myserver-system-2019-08-11 /mnt/borg

# Альтернативно, смонтируем все архивы из репозитория Borg (медленнее):
borg mount /mnt/backup/borg_repo /mnt/borg

# Может потребоваться некоторое время, прежде чем вы увидите содержимое в /mnt/borg.

# Теперь используйте другой терминал или файловый браузер и посмотрите содержимое в /mnt/borg.
# Когда закончите, размонтируйте, чтобы разблокировать репозиторий и разблокировать терминал:
borg umount /mnt/borg
```

### Пример с **borg extract**:

```bash
# borg extract всегда извлекает в текущий каталог, и этот каталог
# должен быть пустым (borg не поддерживает преобразование непустого каталога в
# состояние, которое присутствует в вашем архиве резервной копии).
mkdir borg_restore
cd borg_restore

# Теперь мы узнаем имена архивов, которые у нас есть в репозитории:
borg list /mnt/backup/borg_repo

# Мы можем выяснить содержимое архива, особенно структуру пути:
borg list /mnt/backup/borg_repo::myserver-system-2019-08-11

# Извлекаем только некоторый конкретный путь (заметьте: без начального / !):
borg extract /mnt/backup/borg_repo::myserver-system-2019-08-11 path/to/extract

# Альтернативно, мы можем полностью извлечь архив:
borg extract /mnt/backup/borg_repo::myserver-system-2019-08-11

# Теперь переместите файлы в нужное место...
```

### Различия при использовании **удаленного сервера резервного копирования Borg**:

В целом, все то же самое, что и с локальным репозиторием, но вам нужно ссылаться на репозиторий с помощью URL `ssh://`.

В данном примере `borg` — это имя пользователя, используемое для входа в машину `backup.example.org`, которая работает по SSH на порту `2222` и имеет репозиторий Borg в `/path/to/repo`.

Вместо указания полного доменного имени (FQDN) или имени хоста вы также можете указать IP-адрес.

Как обычно, вам нужен либо пароль для входа, либо сервер резервного копирования может иметь аутентификацию, настроенную через SSH `authorized_keys` (что вероятно, если резервное копирование выполнялось без присмотра).

```bash
borg mount ssh://borg@backup.example.org:2222/path/to/repo /mnt/borg
# или
borg extract ssh://borg@backup.example.org:2222/path/to/repo
```

[Установка](https://borgbackup.readthedocs.io/en/stable/installation.html "предыдущая глава (используйте стрелку влево)")

[Использование](https://borgbackup.readthedocs.io/en/stable/usage.html "следующая глава (используйте стрелку вправо)")
